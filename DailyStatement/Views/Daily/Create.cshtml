@model DailyStatement.Models.DailyInfo

@{
    ViewBag.Title = "新增工時日誌";
}
<style>
    .error {
        background-color: Pink;
    }
</style>
<div class="row">
    <div class="span6 offset3">
<h4>新增</h4>
@using (Html.BeginForm()) {
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>工時日誌</legend>

        <div class="editor-label">
            @Html.LabelFor(model => model.Project.ProjectNo)
        </div>
        <div class="editor-field">
            <input type="text" name="projectid" id="projectid" />
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.WorkCategory)
        </div>
    
        <div class="editor-field">
            @Html.DropDownListFor(model => model.WorkCategoryId, ViewData["Categories"] as SelectList)
            @*Html.DropDownList("categories", ViewData["Categories"] as SelectList, "請選擇", Model.WorkCategoryId)*@
            @Html.ValidationMessageFor(model => model.WorkCategoryId)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.WorkContent)
        </div>
        <div class="editor-field">
            @Html.TextAreaFor(model => model.WorkContent)
            @Html.ValidationMessageFor(model => model.WorkContent)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.CreateDate)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.CreateDate)
            @Html.ValidationMessageFor(model => model.CreateDate)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.WorkingHours)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.WorkingHours)
            @Html.ValidationMessageFor(model => model.WorkingHours)
        </div>
        
        @if(User.IsInRole("超級管理員") || User.IsInRole("一般管理員"))
        {
        <div class="editor-label">
            @Html.LabelFor(model => model.Employee.Name)
        </div>
        <div class="editor-field">
            @Html.DropDownList("EmployeeList")
        </div>
        }

        <p>
            <input type="submit" value="確認" class="btn btn-small btn-success" />  @Html.ActionLink("返回", "Index", null, new { @class="btn btn-small" })
        </p>
    </fieldset>
}

</div>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "/Daily/GetProjects",
                    type: "post"
                }
            }
        });

        var _combobox = $("#projectid").kendoComboBox({
            dataSource: dataSource,
            dataTextField: "ProjectNo",
            dataValueField: "ProjectId",
            filter: "contains"
            
        }).data("kendoComboBox");

        _combobox.input.on("blur", _combobox, function (e) {
            var inputField = $(e.currentTarget);
            var combobox = e.data;
            var found = false;
            var tooltip = "";
            if (inputField.val().length == 0) {
                found = true;
            } else {
                $.each(_combobox.dataSource._data, function (idx, project) {
                    if (project.ProjectId === inputField.val()) {
                        found = true;
                        tooltip = project.ProjectNo;
                        return false;
                    }
                });
            }
            if (found == false) {
                e.preventDefault();
                $(e.currentTarget).addClass("error").removeAttr("title");
                setTimeout(function () {
                    inputField.focus().select();
                }, 100);
            } else {
                $(e.currentTarget).removeClass("error").attr("title", tooltip);
            }
        });

        $(function () {
            $('#CreateDate').kendoDatePicker({
                    culture: "zh-TW",
                    format: "yyyy/MM/dd"
            });
        }); 
    </script>
}
