@{
    ViewBag.Title = "報表查詢";
}
@section scripts
{
    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/Scripts/chosen.jquery.js")
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/Scripts/excanvas.min.js"></script><![endif]-->
    @Scripts.Render("~/Scripts/jquery.flot.js")
    <script>
        // functions
        
        // jQuery
        $(function () {
            var weeksOfMonth;
            @if (User.Identity.IsAuthenticated && (User.IsInRole("超級管理員") || User.IsInRole("一般管理員") || User.IsInRole("助理")))
            {
                @:$('#employeeId').removeAttr('readonly');

            }
            @if (User.Identity.IsAuthenticated && User.IsInRole("一般人員"))
            {
                @:$("#tab-item-2").remove();
                @:$("#tabs-2").remove();
                @:$("#tab-item-3").remove();
                @:$("#tabs-3").remove();
            }
            @*var window = $("#dialog").kendoWindow({
                draggable: true,
                resizable: false,
                width: 360,
                height: 300,
                title: "Query",
                actions: ["Refresh"]
               
            });*@
            
            $('#months').change(function () {
                weeksOfMonth = {};
                var today = new Date();
                var year = today.getFullYear();
                var month = $(this).val();
                var daysInMonth = new Date(year, month, 0).getDate();
                var firstDayOfMonth = new Date(year, month - 1, 1).getDay();
                var firstWeekEndDay = 7 - firstDayOfMonth;
                // get first week
                // weeksOfMonth[1] = { start: new Date(year, month - 1, 1), end: new Date(year, month - 1, firstWeekEndDay) }
                for (i = firstWeekEndDay, j = 1; i < daysInMonth; i = i + 7, j++) {
                    if (i + 7 > daysInMonth) {
                        if (month < 12) {
                            var nextFirstDayOfMonth = new Date(year, month, 1).getDay();
                            var nextFirstWeekEndDay = 7 - nextFirstDayOfMonth;
                            weeksOfMonth[j] = { 'start': new Date(year, month - 1, i + 1), 'end': new Date(year, month, nextFirstWeekEndDay) };
                        } else {
                            weeksOfMonth[j] = { 'start': new Date(year, month - 1, i + 1), 'end': new Date(year, month, 0) };
                        }
                    } else {
                        weeksOfMonth[j] = { 'start': new Date(year, month - 1, i + 1), 'end': new Date(year, month - 1, i + 7) };
                    }
                }
                $('#weeks').find('option').remove();
                $.each(weeksOfMonth, function (key, value) {
                    var start = (value['start'].getMonth() + 1) + '/' + value['start'].getDate();
                    var end = (value['end'].getMonth() + 1) + '/' + value['end'].getDate();
                    $('#weeks').append('<option value="' + key + '">' + start + ' - ' + end + '</option>');

                });
                $('#weeks').trigger('change');
            });

            $('#weeks').change(function () {
                var d = weeksOfMonth[$(this).val()];
                var start = d['start'].getFullYear() + '/' + (d['start'].getMonth() + 1) + '/' + d['start'].getDate();
                var end = d['end'].getFullYear() + '/' + (d['end'].getMonth() + 1) + '/' + d['end'].getDate();
                $('input[name=fromDate]').val(start);
                $('input[name=toDate]').val(end);

            });
            var today = new Date();
            $('#months').val(today.getMonth() + 1).trigger('change');

            $("#tabs").tabs();

            $("#projectNo").chosen({
                no_results_text: "無此案號",
                enable_split_word_search: true,
                search_contains: true
            });

            //--
            var d1 = [];
            for (var i = 0; i < 14; i += 0.5) {
                d1.push([i, Math.sin(i)]);
            }

            var d2 = [[0, 3], [4, 8], [8, 5], [9, 13]];

            // A null signifies separate line segments

            var d3 = [[0, 12], [7, 12], null, [7, 2.5], [12, 2.5]];

            $.plot("#placeholder", [d1, d2, d3]);

            //--
        });
    </script>
}
<link href="~/Content/chosen.css" rel="stylesheet" />
<div class="row">
    <div id="tabs">
        <ul>
            <li id="tab-item-1"><a href="#tabs-1">個人週報表</a></li>
            <li id="tab-item-2"><a href="#tabs-2">專案報表</a></li>
            <li id="tab-item-3"><a href="#tabs-3">年度專案進度報表</a></li>
            <li id="tab-item-4"><a href="#tabs-4">專案進度圖表</a></li>
        </ul>
        <div id="tabs-1">
            @using (Html.BeginForm("ReportWeekForSingle", "Daily", FormMethod.Post, new { id = "dialog" }))
            { 
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true)
                <div style="width: auto; display: block;">
                    <fieldset style="width: 300px; margin: 0 auto;">

                        @Html.Hidden("fromDate")
                        @Html.Hidden("toDate")

                        <div class="editor-label">
                            User: 
                        </div>
                        <div class="editor-field">
                            @Html.DropDownList("employeeId", (SelectList)ViewBag.Employee, null, new { @readonly = "readonly" })
                        </div>
                        <div class="editor-label">
                            Month:
                        </div>
                        <div class="editor-field">
                            @Html.DropDownList("months", (SelectList)ViewBag.Months)
                        </div>
                        <div class="editor-label">
                            Weeks:
                        </div>
                        <div class="editor-field">
                            <select id="weeks"></select>
                        </div>
                        <div class="row">
                            <div class="pull-right span2">
                                <input type="submit" value="查詢" class="btn btn-small btn-success" />
                                @Html.ActionLink("返回", "Index", null, new { @class = "btn btn-small" })
                            </div>
                        </div>
                    </fieldset>
                </div>
        }
        </div>

        <div id="tabs-2">
            @using (Html.BeginForm("GenerateProjectReport", "Daily", FormMethod.Post, new { id = "dialog" }))
            { 
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true)
                <div style="width: auto; display: block;">
                    <fieldset style="width: 300px; margin: 0 auto;">

                        <div class="editor-label">
                            Project No: 
                        </div>
                        <div class="editor-field">
                            @Html.DropDownList("projectNo", (SelectList)ViewData["Projects"])
                        </div>
                        <div class="editor-label">
                            Work Category:
                        </div>
                        <div class="editor-field">
                            @Html.DropDownList("workCategoryId", (SelectList)ViewBag.WorkCategory, "全部", null)
                        </div>
                        <div class="row">
                            <div class="pull-right span2">
                                <input type="submit" value="查詢" class="btn btn-small btn-success" />
                                @Html.ActionLink("返回", "Index", null, new { @class = "btn btn-small" })
                            </div>
                        </div>
                    </fieldset>
                </div>
        }
        </div>

        <div id="tabs-3">
            @Html.ActionLink("年度專案進度報表", "ReportSummaryOfYear", null, new { @class="btn btn-small"})
        </div>

        <div id="tabs-4">


           



        </div>
    </div>


</div>
<div class="row">
    <div class="span12">
         <!---->
            <style>
                .demo-container {
                    box-sizing: border-box;
                    width: 850px;
                    height: 450px;
                    padding: 20px 15px 15px 15px;
                    margin: 15px auto 30px auto;
                    border: 1px solid #ddd;
                    background: #fff;
                    background: linear-gradient(#f6f6f6 0, #fff 50px);
                    background: -o-linear-gradient(#f6f6f6 0, #fff 50px);
                    background: -ms-linear-gradient(#f6f6f6 0, #fff 50px);
                    background: -moz-linear-gradient(#f6f6f6 0, #fff 50px);
                    background: -webkit-linear-gradient(#f6f6f6 0, #fff 50px);
                    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
                    -o-box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                    -ms-box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                    -moz-box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                    -webkit-box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                }

                .demo-placeholder {
                    width: 100%;
                    height: 100%;
                    font-size: 12px;
                    line-height: 12px;
                }

            </style>
           
            <div class="demo-container">
                <div id="placeholder" class="demo-placeholder"></div>
            </div>
           

            <!---->
    </div>
</div>



